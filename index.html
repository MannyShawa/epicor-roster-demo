<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Epicor Weekly Planner</title>

<style>
:root{
 --job:#90d2b5;
 --holiday:#ff8873;
 --leave:#ffe9b3;
 --grid:#d9d9d9;
 --bg:#f5f7f8;
 --primary:#053c55;
}

body{
 margin:0;
 font-family:Segoe UI, Arial;
 background:var(--bg);
}

header{
 background:var(--primary);
 color:white;
 padding:14px 20px;
 display:flex;
 justify-content:space-between;
 align-items:center;
}

h1{margin:0;font-size:18px;}
.version{font-size:12px;opacity:.8;}

.controls{
 padding:10px 20px;
 display:flex;
 gap:20px;
 background:white;
 border-bottom:1px solid var(--grid);
}

select{
 padding:6px;
}

.board{
 display:grid;
 grid-template-columns:260px 100px repeat(7,1fr);
}

.cell{
 border-right:1px solid var(--grid);
 border-bottom:1px solid var(--grid);
 padding:6px;
 min-height:80px;
 background:white;
 position:relative;
}

.header{
 background:#eef2f5;
 font-weight:600;
}

.resource{
 display:flex;
 align-items:center;
 gap:10px;
}

.avatar{
 width:42px;
 height:42px;
 border-radius:8px;
 overflow:hidden;
 background:#ddd;
 display:flex;
 align-items:center;
 justify-content:center;
 font-weight:bold;
}

.avatar img{
 width:100%;
 height:100%;
 object-fit:cover;
}

.job{
 background:var(--job);
 padding:4px 6px;
 border-radius:6px;
 font-size:12px;
 margin-bottom:4px;
 cursor:grab;
}

.range{
 padding:4px 6px;
 border-radius:6px;
 font-size:12px;
 margin-bottom:4px;
 cursor:pointer;
 display:flex;
 justify-content:space-between;
 align-items:center;
}

.holiday{ background:var(--holiday); }
.leave{ background:var(--leave); }

.delete-btn{
 font-size:11px;
 cursor:pointer;
 margin-left:6px;
}

.modal{
 position:fixed;
 inset:0;
 background:rgba(0,0,0,.4);
 display:none;
 align-items:center;
 justify-content:center;
}

.modal-box{
 background:white;
 width:520px;
 padding:20px;
 border-radius:10px;
}

.modal h3{margin-top:0;}
button{padding:6px 10px;margin-top:10px;}
</style>
</head>

<body>

<header>
 <h1>Epicor Weekly Resource Planner</h1>
 <div class="version">v2.0.0</div>
</header>

<div class="controls">
 <label>Shift:
  <select id="shiftFilter" onchange="renderBoard()">
   <option value="both">Both</option>
   <option value="Day">Day</option>
   <option value="Night">Night</option>
  </select>
 </label>

 <label>Department:
  <select id="deptFilter" onchange="renderBoard()">
   <option value="all">All</option>
   <option value="Assembly">Assembly</option>
   <option value="Welding">Welding</option>
   <option value="Paint">Paint</option>
  </select>
 </label>
</div>

<div class="board" id="board"></div>

<div class="modal" id="modal">
 <div class="modal-box">
   <h3 id="modalTitle"></h3>
   <div id="modalBody"></div>
   <button onclick="closeModal()">Close</button>
 </div>
</div>

<script>
const PHOTO_BASE="assets/Employees";

const resources=[
 {id:"EMP001",name:"John Smith",dept:"Assembly"},
 {id:"EMP002",name:"Sarah Lee",dept:"Welding"},
 {id:"EMP003",name:"Michael Tran",dept:"Paint"}
];

const jobs=[
 {id:"J1",jobNumber:"J-10021",part:"PN-AX12",asm:"10",op:"020",opDesc:"Wiring",qty:2,dur:6},
 {id:"J2",jobNumber:"J-10040",part:"PN-FAT01",asm:"20",op:"010",opDesc:"FAT",qty:1,dur:3}
];

let assignments=[];
let ranges=[];
let movingRange=null;

function getWeek(){
 const now=new Date();
 const monday=new Date(now.setDate(now.getDate()-now.getDay()+1));
 let arr=[];
 for(let i=0;i<7;i++){
  let d=new Date(monday);
  d.setDate(monday.getDate()+i);
  arr.push({key:d.toISOString().slice(0,10),label:d.toDateString().slice(0,10)});
 }
 return arr;
}

function renderBoard(){
 const board=document.getElementById("board");
 board.innerHTML="";
 const days=getWeek();
 const shiftFilter=document.getElementById("shiftFilter").value;
 const deptFilter=document.getElementById("deptFilter").value;

 board.appendChild(headerCell("Resource"));
 board.appendChild(headerCell("Shift"));
 days.forEach(d=>board.appendChild(headerCell(d.label)));

 resources
 .filter(r=>deptFilter==="all"||r.dept===deptFilter)
 .forEach(r=>{
  ["Day","Night"].forEach(shift=>{
   if(shiftFilter!=="both"&&shift!==shiftFilter)return;

   board.appendChild(resourceCell(r));
   board.appendChild(headerCell(shift));

   days.forEach(d=>{
    const c=document.createElement("div");
    c.className="cell";
    c.ondrop=e=>handleDrop(e,r.id,d.key,shift);
    c.ondragover=e=>e.preventDefault();
    c.onclick=()=>handleMove(d.key,r.id);
    renderCellContent(c,r.id,d.key,shift);
    board.appendChild(c);
   });
  });
 });
}

function headerCell(text){
 const d=document.createElement("div");
 d.className="cell header";
 d.textContent=text;
 return d;
}

function resourceCell(r){
 const c=document.createElement("div");
 c.className="cell resource";
 const avatar=document.createElement("div");
 avatar.className="avatar";
 const img=new Image();
 img.src=`${PHOTO_BASE}/${r.id}.png`;
 img.onerror=function(){img.src=`assets/employees/${r.id}.png`;};
 avatar.appendChild(img);
 const name=document.createElement("div");
 name.innerHTML=`<b>${r.name}</b><br>${r.dept}`;
 c.appendChild(avatar);
 c.appendChild(name);
 return c;
}

function renderCellContent(cell,resId,day,shift){
 assignments
 .filter(a=>a.resId===resId&&a.day===day&&a.shift===shift)
 .forEach(a=>{
  const j=jobs.find(j=>j.id===a.jobId);
  const div=document.createElement("div");
  div.className="job";
  div.draggable=true;
  div.ondragstart=e=>e.dataTransfer.setData("job",a.jobId);
  div.textContent=`${j.jobNumber} â€¢ ${j.part} â€¢ Op ${j.op}`;
  div.onclick=e=>{e.stopPropagation();openJob(j);};
  cell.appendChild(div);
 });

 ranges
 .filter(r=>r.resId===resId&&r.day===day)
 .forEach(r=>{
  const div=document.createElement("div");
  div.className="range "+r.type;
  div.innerHTML=`${r.label}<span class="delete-btn" onclick="deleteRange('${r.id}')">ðŸ—‘</span>`;
  div.onclick=e=>{e.stopPropagation();openRange(r);};
  cell.appendChild(div);
 });
}

function handleDrop(e,resId,day,shift){
 const jobId=e.dataTransfer.getData("job");
 if(!jobId)return;
 assignments.push({jobId,resId,day,shift});
 renderBoard();
}

function openJob(j){
 document.getElementById("modalTitle").textContent=j.jobNumber;
 document.getElementById("modalBody").innerHTML=
 `<b>Part:</b> ${j.part}<br>
  <b>Assembly:</b> ${j.asm}<br>
  <b>Operation:</b> ${j.op} ${j.opDesc}<br>
  <b>Quantity:</b> ${j.qty}<br>
  <b>Duration:</b> ${j.dur} hours`;
 document.getElementById("modal").style.display="flex";
}

function openRange(r){
 const action=prompt("Type M to Move, D to Delete","M");
 if(!action)return;
 if(action.toUpperCase()==="D")deleteRange(r.id);
 if(action.toUpperCase()==="M"){movingRange=r.id;alert("Click new day to move");}
}

function handleMove(day,resId){
 if(!movingRange)return;
 const r=ranges.find(x=>x.id===movingRange);
 if(!r)return;
 r.day=day;
 movingRange=null;
 renderBoard();
}

function deleteRange(id){
 ranges=ranges.filter(r=>r.id!==id);
 renderBoard();
}

function closeModal(){
 document.getElementById("modal").style.display="none";
}

renderBoard();
</script>
</body>
</html>
